<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>ext\admin\users\lib.js - ice-framework</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="http://ice-framework.gamonoid.com/logo.png" title="ice-framework"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/Base.js.html">Base.js</a></li>
                                <li><a href="../classes/BaseService.html">BaseService</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: ext\admin\users\lib.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * Author: Thilina Hasantha
 */

function UserAdapter(endPoint) {
	this.initAdapter(endPoint);
}

UserAdapter.inherits(AdapterBase);


UserAdapter.method(&#x27;getDataMapping&#x27;, function() {
	return [
	        &quot;id&quot;,
	        &quot;username&quot;,
	        &quot;email&quot;,
	        &quot;profile&quot;,
	        &quot;user_level&quot;
	];
});

UserAdapter.method(&#x27;getHeaders&#x27;, function() {
	return [
			{ &quot;sTitle&quot;: &quot;ID&quot; },
			{ &quot;sTitle&quot;: &quot;User Name&quot; },
			{ &quot;sTitle&quot;: &quot;Authentication Email&quot; },
			{ &quot;sTitle&quot;: &quot;Profile&quot;},
			{ &quot;sTitle&quot;: &quot;User Level&quot;}
	];
});

UserAdapter.method(&#x27;getFormFields&#x27;, function() {
	return [
	        [ &quot;id&quot;, {&quot;label&quot;:&quot;ID&quot;,&quot;type&quot;:&quot;hidden&quot;,&quot;validation&quot;:&quot;&quot;}],
	        [ &quot;username&quot;, {&quot;label&quot;:&quot;User Name&quot;,&quot;type&quot;:&quot;text&quot;,&quot;validation&quot;:&quot;username&quot;}],
	        [ &quot;email&quot;, {&quot;label&quot;:&quot;Email&quot;,&quot;type&quot;:&quot;text&quot;,&quot;validation&quot;:&quot;email&quot;}],
	        [ &quot;profile&quot;, {&quot;label&quot;:&quot;Profile&quot;,&quot;type&quot;:&quot;select&quot;,&quot;allow-null&quot;:true,&quot;remote-source&quot;:[&quot;Profile&quot;,&quot;id&quot;,&quot;first_name+last_name&quot;]}],
	        [ &quot;user_level&quot;, {&quot;label&quot;:&quot;User Level&quot;,&quot;type&quot;:&quot;select&quot;,&quot;source&quot;:[[&quot;Admin&quot;,&quot;Admin&quot;],[&quot;Manager&quot;,&quot;Manager&quot;],[&quot;Profile&quot;,&quot;Profile&quot;]]}]
	];
});

UserAdapter.method(&#x27;postRenderForm&#x27;, function(object, $tempDomObj) {
	if(object == null || object == undefined){
		$tempDomObj.find(&quot;#changePasswordBtn&quot;).remove();
	}
});

UserAdapter.method(&#x27;changePassword&#x27;, function() {
	$(&#x27;#adminUsersModel&#x27;).modal(&#x27;show&#x27;);
	$(&#x27;#adminUsersChangePwd #newpwd&#x27;).val(&#x27;&#x27;);
	$(&#x27;#adminUsersChangePwd #conpwd&#x27;).val(&#x27;&#x27;);
});

UserAdapter.method(&#x27;saveUserSuccessCallBack&#x27;, function(callBackData,serverData) {
	this.showMessage(&quot;Create User&quot;,&quot;An email has been sent to &quot;+callBackData[&#x27;email&#x27;]+&quot; with a temporary password to login to IceHrm.&quot;);
	this.get([]);
});

UserAdapter.method(&#x27;saveUserFailCallBack&#x27;, function(callBackData,serverData) {
	this.showMessage(&quot;Error&quot;,callBackData);
});

UserAdapter.method(&#x27;doCustomValidation&#x27;, function(params) {
	var msg = null;
	if(params[&#x27;user_level&#x27;] != &quot;Admin&quot; &amp;&amp; params[&#x27;profile&#x27;] == &quot;NULL&quot;){
		msg = &quot;For non Admin users, you have to assign a profile when adding or editing the user.&lt;br/&gt;&quot;;
		msg += &quot; You may create a new profile through &#x27;Admin&#x27;-&gt;&#x27;Profiless&#x27; menu&quot;;
	}
	return msg;
});

UserAdapter.method(&#x27;save&#x27;, function() {
	var validator = new FormValidation(this.getTableName()+&quot;_submit&quot;,true,{&#x27;ShowPopup&#x27;:false,&quot;LabelErrorClass&quot;:&quot;error&quot;});
	if(validator.checkValues()){
		var params = validator.getFormParameters();
		
		var msg = this.doCustomValidation(params);
		if(msg == null){
			var id = $(&#x27;#&#x27;+this.getTableName()+&quot;_submit #id&quot;).val();
			if(id != null &amp;&amp; id != undefined &amp;&amp; id != &quot;&quot;){
				$(params).attr(&#x27;id&#x27;,id);
				this.add(params,[]);
			}else{
				
				var reqJson = JSON.stringify(params);
				
				var callBackData = [];
				callBackData[&#x27;callBackData&#x27;] = [];
				callBackData[&#x27;callBackSuccess&#x27;] = &#x27;saveUserSuccessCallBack&#x27;;
				callBackData[&#x27;callBackFail&#x27;] = &#x27;saveUserFailCallBack&#x27;;
				
				this.customAction(&#x27;saveUser&#x27;,&#x27;admin=users&#x27;,reqJson,callBackData);
			}
			
		}else{
			//$(&quot;#&quot;+this.getTableName()+&#x27;Form .label&#x27;).html(msg);
			//$(&quot;#&quot;+this.getTableName()+&#x27;Form .label&#x27;).show();
			this.showMessage(&quot;Error Saving User&quot;,msg);
		}
		
		
		
	}
});


UserAdapter.method(&#x27;changePasswordConfirm&#x27;, function() {
	$(&#x27;#adminUsersChangePwd_error&#x27;).hide();
	
	var passwordValidation =  function (str) {  
		var val = /^[a-zA-Z0-9]\w{6,}$/;  
		return str != null &amp;&amp; val.test(str);  
	};
	
	var password = $(&#x27;#adminUsersChangePwd #newpwd&#x27;).val();
	
	if(!passwordValidation(password)){
		$(&#x27;#adminUsersChangePwd_error&#x27;).html(&quot;Password may contain only letters, numbers and should be longer than 6 characters&quot;);
		$(&#x27;#adminUsersChangePwd_error&#x27;).show();
		return;
	}
	
	var conPassword = $(&#x27;#adminUsersChangePwd #conpwd&#x27;).val();
	
	if(conPassword != password){
		$(&#x27;#adminUsersChangePwd_error&#x27;).html(&quot;Passwords don&#x27;t match&quot;);
		$(&#x27;#adminUsersChangePwd_error&#x27;).show();
		return;
	}
	
	var req = {&quot;id&quot;:this.currentId,&quot;pwd&quot;:conPassword};
	var reqJson = JSON.stringify(req);
	
	var callBackData = [];
	callBackData[&#x27;callBackData&#x27;] = [];
	callBackData[&#x27;callBackSuccess&#x27;] = &#x27;changePasswordSuccessCallBack&#x27;;
	callBackData[&#x27;callBackFail&#x27;] = &#x27;changePasswordFailCallBack&#x27;;
	
	this.customAction(&#x27;changePassword&#x27;,&#x27;admin=users&#x27;,reqJson,callBackData);
	
});

UserAdapter.method(&#x27;closeChangePassword&#x27;, function() {
	$(&#x27;#adminUsersModel&#x27;).modal(&#x27;hide&#x27;);
});

UserAdapter.method(&#x27;changePasswordSuccessCallBack&#x27;, function(callBackData,serverData) {
	this.closeChangePassword();
	this.showMessage(&quot;Password Change&quot;,&quot;Password changed successfully&quot;);
});

UserAdapter.method(&#x27;changePasswordFailCallBack&#x27;, function(callBackData,serverData) {
	this.closeChangePassword();
	this.showMessage(&quot;Error&quot;,callBackData);
});





    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
